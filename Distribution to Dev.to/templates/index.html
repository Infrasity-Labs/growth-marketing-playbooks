<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dev.to Publisher</title>
  <style>
    :root {
      --bg: linear-gradient(145deg, #0f172a 0%, #111827 100%);
      --card: #0b1220;
      --accent: #6ee7b7;
      --accent-2: #93c5fd;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --shadow: 0 20px 60px rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box; }
    body { margin: 0; min-height: 100vh; display: flex; align-items: flex-start; justify-content: center; background: var(--bg); color: var(--text); font-family: "Inter", system-ui, -apple-system, sans-serif; padding: 32px 18px; }
    .container { width: min(760px, 100%); text-align: center; display: flex; flex-direction: column; gap: 16px; }
    h1 { margin: 0 0 8px; font-weight: 800; letter-spacing: -0.02em; }
    p.lead { margin: 0 0 18px; color: var(--muted); }
    form { background: var(--card); padding: 24px; border-radius: 16px; box-shadow: var(--shadow); border: 1px solid rgba(148, 163, 184, 0.25); display: flex; flex-direction: column; gap: 14px; }
    label { display: block; text-align: left; margin-bottom: 6px; font-weight: 600; color: var(--text); }
    input[type=text] { width: 100%; padding: 12px 14px; border: 1px solid rgba(148, 163, 184, 0.35); border-radius: 12px; background: #0f172a; color: var(--text); font-size: 15px; }
    input[type=text]::placeholder { color: var(--muted); }
    .actions { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
    .toggle { display: flex; align-items: center; gap: 8px; color: var(--muted); font-weight: 600; }
    button { margin-top: 4px; width: 100%; padding: 14px 16px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0f172a; border: none; border-radius: 12px; font-weight: 800; letter-spacing: 0.01em; cursor: pointer; box-shadow: 0 12px 30px rgba(147, 197, 253, 0.35); transition: transform 0.05s ease, filter 0.15s ease; }
    button:hover { filter: brightness(1.05); transform: translateY(-1px); }
    button:disabled { cursor: not-allowed; opacity: 0.7; filter: grayscale(0.2); }
    .card { background: var(--card); padding: 16px 18px; border-radius: 14px; box-shadow: var(--shadow); border: 1px solid rgba(148, 163, 184, 0.25); width: min(760px, 100%); text-align: left; margin: 0 auto; }
    pre { white-space: pre-wrap; word-wrap: break-word; color: var(--text); }
    .status { color: #34d399; }
    .errors { color: #fca5a5; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Dev.to Publisher</h1>
    <p class="lead">Step 1: generate draft markdown + banner. Step 2: publish to Dev.to only when you click Publish.</p>

    <form method="post" id="generate-form">
      <input type="hidden" name="action" value="generate" />
      <label>Article URL</label>
      <input type="text" name="url" placeholder="https://example.com/your-post" value="{{ source_url or '' }}" required />
      <button type="submit" id="generate-btn">Generate draft</button>
    </form>

    {% if status_messages %}
    <div class="card status">
      <h3>Status</h3>
      <ul>
        {% for msg in status_messages %}<li>{{ msg }}</li>{% endfor %}
      </ul>
    </div>
    {% endif %}

    {% if errors %}
    <div class="card errors">
      <h3>Errors</h3>
      <ul>
        {% for err in errors %}<li>{{ err }}</li>{% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>

  {% if banner_url or summary_md %}
  <div class="card">
    {% if banner_url %}
      <h3>Banner Preview</h3>
      <img src="{{ banner_url }}" alt="Banner" style="width:100%;max-height:360px;object-fit:cover;border-radius:12px;margin-bottom:12px;" />
    {% endif %}

    {% if summary_md %}
      <h3>Generated Markdown</h3>
      <pre>{{ summary_md }}</pre>

      <form method="post" style="margin-top:14px;">
        <input type="hidden" name="action" value="publish" />
        <input type="hidden" name="title" value="{{ title or '' }}" />
        <input type="hidden" name="url" value="{{ source_url or '' }}" />
        <input type="hidden" name="banner_url" value="{{ banner_url or '' }}" />
        <textarea name="summary_md" style="display:none;">{{ summary_md }}</textarea>
        <button type="submit">Publish to Dev.to</button>
      </form>
    {% endif %}
  </div>
  {% endif %}
  <script>
    const genForm = document.getElementById('generate-form');
    const genBtn = document.getElementById('generate-btn');
    genForm?.addEventListener('submit', () => {
      genBtn.disabled = true;
      genBtn.textContent = 'Working...';
    });
  </script>
</body>
</html>
